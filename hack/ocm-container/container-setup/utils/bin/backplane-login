#!/bin/bash -e

if [ -z $1 ]
then
  echo "First parameter must be a cluster"
  exit 1
fi

# Login to OCM first
echo "Logging into OCM"
if [ "$OCM_URL" == "" ];
then
  OCM_URL="https://api.openshift.com"
fi
ocm login --token=$OFFLINE_ACCESS_TOKEN --url=$OCM_URL

echo "Logging into cluster $1"

# Initialize Tunnel
# pipe stdout to /dev/null because the `starting sshuttle for ...` message
# only appears in stdout. This should still prompt for the password if
# necessary.
ocm backplane tunnel -D > /dev/null

# Login to the Cluster
ocm backplane login "$1"
