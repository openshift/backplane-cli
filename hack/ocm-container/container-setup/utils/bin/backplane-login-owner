#!/bin/bash

set -eEuo pipefail

if [ -z $1 ]
then
  echo "First parameter must be a cluster"
  exit 1
fi

# Login to OCM first
echo "Logging into OCM"
if [ "$OCM_URL" == "" ];
then
  OCM_URL="https://api.openshift.com"
fi
ocm login --token=$OFFLINE_ACCESS_TOKEN --url=$OCM_URL

echo "Finding owner of cluster $1"
CLUSTERID=$(get-shards-clusterid -c ${1})

echo "Logging into the owner of cluster $1 - $CLUSTERID"

# Login to the Cluster
ocm backplane login "$CLUSTERID"
